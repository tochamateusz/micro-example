version: '3'

tasks:
  start:
    cmds:
      - go run ./cmd
  start-dev:
    cmds:
      - reflex -r '\.go$' -d none -s -- sh -c 'clear && go run ./cmd'

  test-dev:
    cmds:
      - task test_migrateup
      - reflex -r '\_test.go' -d none -s -- sh -c 'go test -v ./db/sqlc/...'

  test_migrateup:
    cmds:
      - migrate -path ./db/migrations -database "postgresql://root:password_test@0.0.0.0:5432/simple_bank_test?sslmode=disable" -verbose up

  test_migratedown:
    cmds:
      - migrate -path ./db/migrations -database "postgresql://root:password_test@0.0.0.0:5432/simple_bank_test?sslmode=disable" -verbose down

  migrateup:
    cmds:
      - migrate -path ./db/migrations -database "postgresql://root:password@0.0.0.0:5432/simple_bank?sslmode=disable" -verbose up

  migratedown:
    cmds:
      - migrate -path ./db/migrations -database "postgresql://root:password@0.0.0.0:5432/simple_bank?sslmode=disable" -verbose down

  sqlc:
    cmds:
      - sqlc generate
    
